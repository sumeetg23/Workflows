# Workflows

This repository contains two bioinformatics workflow pipelines for NGS data processing:

1. **Snakemake-CreateAndQCRawData** - A Snakemake workflow for demultiplexing and quality control of raw sequencing data
2. **nextflow-single-cell-pipeline** - A Nextflow pipeline for single-cell RNA sequencing analysis

---

## ğŸ“ Project Overview

### 1. Snakemake-CreateAndQCRawData

A Snakemake-based workflow designed for the initial processing and quality control of raw NGS sequencing runs. This pipeline handles:

- **Demultiplexing**: Converts BCL files to FASTQ format using `bcl2fastq`
- **Quality Control**: Performs FastQC and FastQ Screen analysis on demultiplexed FASTQ files
- **Report Generation**: Creates MultiQC reports summarizing QC metrics on a per-lane basis

**Key Features:**
- Automated sample sheet validation
- Per-lane QC reporting
- SLURM cluster support with configurable resource allocation
- Optional adapter trimming with cutadapt
- Optional RSeQC analysis for RNA-seq data

**Workflow Components:**
- `bcl2fastq` - BCL to FASTQ conversion
- `fastqc` - Quality control analysis
- `fastqscreen` - Contamination screening
- `multiqc` - Aggregate QC reports

### 2. nextflow-single-cell-pipeline

A Nextflow-based pipeline for comprehensive single-cell RNA sequencing analysis, specifically designed for inDrop protocol data. This pipeline performs:

- **Quality Control**: FastQC and FastQ Screen analysis
- **Read Filtering**: Optional FASTQ filtering and preprocessing
- **Genome Indexing**: STAR genome index generation
- **Alignment**: STARsolo alignment for single-cell data
- **Report Generation**: MultiQC reports for quality assessment

**Key Features:**
- Containerized execution with Singularity
- Handles multi-read single-cell data (R1/R2/R4)
- Configurable filtering parameters
- Automatic STAR index management
- Comprehensive execution reports and DAG visualization

**Pipeline Modules:**
- `fastqc.nf` - Quality control analysis
- `fastq_screen.nf` - Contamination screening
- `filterfastq.nf` - FASTQ filtering and preprocessing
- `multiqc.nf` - Aggregate QC reports
- `star_index.nf` - STAR genome indexing
- `star_solo.nf` - STARsolo single-cell alignment

---

## ğŸš€ Quick Start

### Snakemake Workflow

Navigate to the Snakemake directory and configure your run:

```bash
cd Snakemake-CreateAndQCRawData
```

Edit `config.yaml` to specify:
- Sample sheet path
- Run folder path
- BCL2FASTQ parameters
- Optional cutadapt and RSeQC settings

Run the workflow:

```bash
snakemake -s rules/bcl2fastq.smk \
  --cluster-config clusterTime.json \
  --cluster "sbatch --mem={cluster.mem} --cpus-per-task={cluster.cpus_per_task} --account={cluster.account} --partition={cluster.slurm_partition} --output %j.out --wrap" \
  --jobs 100 \
  --latency-wait 60
```

### Nextflow Pipeline

Navigate to the Nextflow directory:

```bash
cd nextflow-single-cell-pipeline
```

Edit `nextflow.config` to configure:
- Input directory path
- Output directory
- Sample names
- Reference genome paths (FASTA and GTF)
- Resource requirements

Run the pipeline:

```bash
nextflow run main.nf -profile singularity
```

---

## ğŸ“‹ Requirements

### Snakemake Workflow
- Snakemake (â‰¥5.19.3)
- bcl2fastq
- FastQC
- FastQ Screen
- MultiQC
- SLURM (for cluster execution)
- Python 3 with pandas

### Nextflow Pipeline
- Nextflow
- Singularity (for containerized execution)
- Reference genome files (FASTA and GTF)
- STAR genome index (optional - can be generated by pipeline)

---

## ğŸ“‚ Directory Structure

```
Workflows/
â”œâ”€â”€ Snakemake-CreateAndQCRawData/
â”‚   â”œâ”€â”€ config.yaml              # Main configuration file
â”‚   â”œâ”€â”€ clusterTime.json         # SLURM cluster configuration
â”‚   â”œâ”€â”€ rules/
â”‚   â”‚   â””â”€â”€ bcl2fastq.smk       # Main Snakemake workflow
â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â””â”€â”€ config.schema.yaml  # Configuration schema validation
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ helper.py            # Helper functions
â”‚       â”œâ”€â”€ PreProcess-Summary.sh # MultiQC summary script
â”‚       â””â”€â”€ versions.py         # Version tracking
â”‚
â””â”€â”€ nextflow-single-cell-pipeline/
    â”œâ”€â”€ main.nf                  # Main Nextflow pipeline
    â”œâ”€â”€ nextflow.config          # Nextflow configuration
    â”œâ”€â”€ modules/                 # Nextflow modules
    â”‚   â”œâ”€â”€ fastqc.nf
    â”‚   â”œâ”€â”€ fastq_screen.nf
    â”‚   â”œâ”€â”€ filterfastq.nf
    â”‚   â”œâ”€â”€ multiqc.nf
    â”‚   â”œâ”€â”€ star_index.nf
    â”‚   â””â”€â”€ star_solo.nf
    â”œâ”€â”€ scripts/                 # Supporting scripts
    â”‚   â””â”€â”€ filterfastq.py
    â”œâ”€â”€ genotype/                # Genotyping-related files
    â”‚   â”œâ”€â”€ plot.R
    â”‚   â””â”€â”€ workflow.sh
    â””â”€â”€ make_whitelist.sh        # Whitelist generation script
```

---

## âš™ï¸ Configuration

### Snakemake Configuration

Key parameters in `config.yaml`:
- `bcl2fastq`: BCL conversion settings (sample sheet, run folder, threads)
- `cutadapt`: Optional adapter trimming configuration
- `rseqc`: Optional RSeQC analysis settings

### Nextflow Configuration

Key parameters in `nextflow.config`:
- `input_dir`: Path to input FASTQ files
- `outdir`: Output directory
- `samples`: List of sample names
- `fa`: Reference genome FASTA file
- `gtf`: Annotation GTF file
- `run_filtering`: Enable/disable FASTQ filtering
- Resource settings for each process

---

## ğŸ”„ Workflow Integration

These workflows are designed to work sequentially:

1. **Snakemake-CreateAndQCRawData**: Processes raw BCL files â†’ demultiplexed FASTQ files with QC
2. **nextflow-single-cell-pipeline**: Takes processed FASTQ files â†’ single-cell analysis with alignment

The output from the Snakemake workflow (demultiplexed FASTQ files) can serve as input to the Nextflow pipeline for downstream single-cell analysis.

---

## ğŸ“Š Output Files

### Snakemake Workflow
- Demultiplexed FASTQ files in `FASTQ/` directory
- FastQC reports in `FASTQC/` directory
- FastQ Screen reports in `FASTQSCREEN/` directory
- MultiQC reports in `MULTIQC/` directory (per-lane and aggregate)

### Nextflow Pipeline
- Filtered FASTQ files (if filtering enabled)
- STAR genome index (if generated)
- STARsolo alignment outputs
- MultiQC reports
- Pipeline execution reports (timeline, trace, DAG) in `pipeline_info/`

---

## ğŸ› ï¸ Troubleshooting

### Snakemake
- Ensure sample sheet format is correct (validated by helper scripts)
- Check SLURM cluster configuration in `clusterTime.json`
- Verify all required tools are available in the environment

### Nextflow
- Ensure Singularity is properly configured
- Verify reference genome files are accessible
- Check resource requirements match available cluster resources
- Review execution reports in `pipeline_info/` for detailed error information

---

## ğŸ“ Notes

- Both workflows support cluster execution (SLURM)
- Containerization (Singularity) is recommended for reproducibility
- Configuration files contain example paths that should be updated for your environment
- Sample sheets and reference files must be provided by the user

---

## ğŸ“„ License

[Add your license information here]

---

## ğŸ‘¤ Author

Sumeet Gupta
